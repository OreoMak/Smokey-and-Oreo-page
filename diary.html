<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Our Daily Check-In üíå</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      color: #333;
      padding: 20px;
    }

    .container {
      max-width: 650px;
      margin: auto;
      background: #fff;
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.12);
    }

    h1 {
      text-align: center;
      color: #ff4d6d;
    }

    .intro {
      font-size: 1rem;
      line-height: 1.7;
      margin-bottom: 25px;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 20px;
      font-weight: 600;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      margin-top: 8px;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
    }

    .btn {
      margin-top: 25px;
      width: 100%;
      background: #ff4d6d;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 30px;
      font-size: 1rem;
      cursor: pointer;
    }

    .btn:hover {
      background: #e63956;
    }

    .comfort {
      margin-top: 15px;
      padding: 15px;
      background: #fff0f3;
      border-radius: 12px;
      display: none;
      font-size: 0.95rem;
    }

    .entries {
      margin-top: 40px;
    }

    .entry {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }

    .export-btn {
      margin-top: 10px;
      background: #6c63ff;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Our Daily Check-In üíñ</h1>

    <div class="intro">
      We always ask each other: <br/>
      <strong>‚ÄúOn a scale of 1 to 10, how was your day?‚Äù</strong><br/><br/>
      Life gets busy, emotions get heavy, and sometimes we don‚Äôt fully unpack the answer.
      So I thought‚Ä¶ what if we slow down, reflect, and leave little pieces of our hearts
      here ‚Äî for us, for love, for understanding. ü§ç<br/><br/>
      <em>‚ÄúBe completely humble and gentle; be patient, bearing with one another in love.‚Äù ‚Äì Ephesians 4:2</em>
    </div>

    <label>On a scale of 1‚Äì10, how was your day?</label>
    <input type="number" id="rating" min="1" max="10" />

    <label>If it was hard, what could make it better?  
      If it was good, what made it good?</label>
    <textarea id="reflection" rows="3"></textarea>

    <label>What are you grateful for today?</label>
    <textarea id="gratitude" rows="2"></textarea>

    <label>Optional photo üì∏</label>
    <input type="file" id="photo" />

    <div class="comfort" id="comfortMsg">
      Hey love ü§ç  
      Even hard days don‚Äôt change how deeply you are loved.
      Tomorrow is new. We are a team. God is with us.
    </div>

    <button class="btn" onclick="saveEntry()">Save today‚Äôs check-in üíå</button>
    <button class="btn export-btn" onclick="exportPDF()">Export diary as PDF üìÑ</button>

    <div class="entries" id="entries"></div>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCZSQxvmv6Zxxb-Pp3Yosx5fK22eaGkxzE",
      authDomain: "smokey-oreo-diary.firebaseapp.com",
      projectId: "smokey-oreo-diary"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function saveEntry() {
      const rating = Number(document.getElementById("rating").value);
      const reflection = document.getElementById("reflection").value;
      const gratitude = document.getElementById("gratitude").value;

      if (!rating) {
        alert("Please rate your day üíó");
        return;
      }

      if (rating < 5) {
        document.getElementById("comfortMsg").style.display = "block";
      }

      const today = new Date().toISOString().split("T")[0];

      await addDoc(collection(db, "diaryEntries"), {
        date: today,
        rating,
        reflection,
        gratitude,
        timestamp: new Date()
      });

      loadEntries();
      alert("Saved with love üíû");
    }

    async function loadEntries() {
      const entriesDiv = document.getElementById("entries");
      entriesDiv.innerHTML = "<h3>Our shared diary ü´∂</h3>";

      const q = query(collection(db, "diaryEntries"), orderBy("timestamp", "desc"));
      const snapshot = await getDocs(q);

      snapshot.forEach(doc => {
        const e = doc.data();
        entriesDiv.innerHTML += `
          <div class="entry">
            <strong>${e.date}</strong><br/>
            Rating: ${e.rating}/10<br/>
            Reflection: ${e.reflection}<br/>
            Grateful for: ${e.gratitude}
          </div>`;
      });
    }

    loadEntries();

    function exportPDF() {
      window.print();
    }

    window.exportPDF = exportPDF;
  </script>
</body>
</html>
